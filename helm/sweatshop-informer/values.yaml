# Default values for sweatshop-informer.
namespace: sweatshop

tektonResources:
  enabled: false

tekton-resources:
  enableRuns: true
  runs:
    buildHelmChart:
      name: sws-informer-helm
      addRandomDateToRunName: false
      namespace: tekton-cd
      kind: Pipeline
      ref: package-publish-helmchart
      params:
        git-repo-url: git@github.com:stuttgart-things/sweatShop-informer.git
        git-revision: main
        gitWorkspaceSubdirectory: /helm/sws-i
        helm-chart-name: sweatshop-informer
        helm-chart-tag: 0.8.15
        helm-chart-path: helm
        registry: scr.app.4sthings.tiab.ssc.sva.de
        working-image: "eu.gcr.io/stuttgart-things/sthings-k8s:1.127.2"
      workspaces:
        ssh-credentials:
          workspaceKind: secret
          workspaceRef: github-ssh
        source:
          workspaceKind: persistentVolumeClaim
          workspaceRef: helm-workspace
        dockerconfig:
          workspaceKind: secret
          workspaceRef: scr-labda-vsphere
redis:
  enabled: false
  sentinel:
    enabled: true
  master:
    service:
      type: ClusterIP
    persistence:
      enabled: false
      medium: ""
  replica:
    replicaCount: 1
    persistence:
      enabled: false
      medium: ""
  auth:
    password: just4dev
# configmaps:
#   informer:
#     INFORMING_NAMESPACE: machine-shop-packer
#     INFORMING_KINDS: jobs
#     REDIS_SERVER: sweatshop-informer-redis-headless.sweatshop.svc.cluster.local
#     REDIS_PORT: "6379"
#     REDIS_PASSWORD: just4dev
deployment:
  name: sweatshop-informer
  labels:
    app: sweatshop-informer
  selectorLabels:
    app: sweatshop-informer
  allowPrivilegeEscalation: "false"
  privileged: "false"
  runAsNonRoot: "false"
  readOnlyRootFilesystem: "true"
  serviceAccount: sweatshop-informer
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi
  containers:
    sweatshop-informer:
      image: eu.gcr.io/stuttgart-things/sweatshop-informer
      replicaCount: 1
      imagePullPolicy: Always
      tag: 23.0710.1016-v0.1.11
      securityContext:
        capabilities: {}
# RBAC
serviceAccounts:
  sweatshop-informer:
    labels:
      app: sweatshop-informer
roles:
  sweatshop-informer:
    labels:
      app: sweatshop-informer
    rules:
      - apiGroups:
          - ""
        resources:
          - pods
        verbs:
          - get
          - list
          - watch
      - apiGroups:
          - "batch"
        resources:
          - jobs
        verbs:
          - get
          - list
          - watch
roleBindings:
  sweatshop-informer:
    labels:
      app: sweatshop-informer
    roleRef:
      kind: Role
      name: sweatshop-informer
      apiGroup: rbac.authorization.k8s.io
    subjects:
      - kind: ServiceAccount
        name: sweatshop-informer
        namespace: sweatshop
clusterRoles:
  sweatshop-informer:
    labels:
      app: sweatshop-informer
    rules:
      - apiGroups:
          - ""
        resources:
          - namespaces
        verbs:
          - get
          - list
      - apiGroups:
          - "batch"
        resources:
          - jobs
        verbs:
          - get
          - list
          - watch
clusterRoleBindings:
  sweatshop-informer:
    roleRef:
      kind: ClusterRole
      name: sweatshop-informer
      apiGroup: rbac.authorization.k8s.io
    subjects:
      - kind: ServiceAccount
        name: sweatshop-informer
        namespace: sweatshop
